Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var Mortgage=function(e,t){"use strict";var l=function(){this.settings={currency:"â‚¦",interest:21,$node:t("#mortgage-calculator-container")},this.initialize()};l.prototype.initialize=function(){this.settings.$node.html(this.settings.$node.html().replace(/\{\{currency\}\}/g,'<span class="calculator-currency">'+this.settings.currency+"</span>")),this._model={earn:{value:25e3,limit:{min:0,max:5e7},step:1e3,template:'<span class="number-view">'+this.settings.currency+"{{value}}</span>"},property:{value:5e4,limit:{min:5e3,max:5e7},step:1e3,template:'<span class="number-view">'+this.settings.currency+"{{value}}</span>"},deposit:{value:20,limit:{min:20,max:90},step:5,template:'<span class="number-view deposit-view">{{value}}</span>'},years:{value:1,limit:{min:1,max:20},step:1,template:'<span class="number-view years-view">{{value}}</span>'},lend:{value:0},loan:{value:0,percent:0},payment:{value:0},term:{value:0}},this.chart={data:[],view:t("#mortgage-chart").get(0)},this.extendObject(),this._model.earn.view=new a.NumberInput("#earn-field",this._model.earn),this._model.property.view=new a.NumberInput("#property-field",this._model.property),this._model.deposit.view=new a.NumberInput("#deposit-field",this._model.deposit),this._model.years.view=new a.NumberInput("#years-field",this._model.years),this.calculate()},l.prototype.calculate=function(){this._model.lend.value=(100-this._model.deposit.value)/100*this._model.property.value,this._model.loan.value=this._model.property.value-this._model.earn.value*this._model.deposit.value/100,this._model.loan.percent=parseInt(this._model.loan.value/this._model.property.value*100),this._model.loan.value<0&&(this._model.loan.value=this._model.loan.percent=0),this._model.payment.value=Math.ceil(this.PMT(this.settings.interest/100/12,12*this._model.years.value,-this._model.property.value)),this._model.term.value=this._model.years.value,t("#mortgage-result .result-container.lend-result > .result-container__content").html(this.settings.currency+this.formatNumber(this._model.lend.value)),t("#mortgage-result .result-container.payment-result > .result-container__content").html(this.settings.currency+this.formatNumber(this._model.payment.value)),t("#mortgage-result .result-container.term-result > .result-container__content").html(this._model.term.value+" "+(1==this._model.term.value?"year":"years")),this.chart.data=[{value:this._model.deposit.value,label:"Contribution: "+this.settings.currency+this.formatNumber(this._model.property.value-this._model.lend.value),legend:"Contribution",color:"#7b9aaf"},{value:100-this._model.deposit.value,label:"Amount Financed: "+this.settings.currency+this.formatNumber(this._model.lend.value),legend:"Amount Financed",color:"#022e64"}],this.renderChart()},l.prototype.PMT=function(e,t,l){return e*l*Math.pow(1+e,t)/(1-Math.pow(1+e,t))},l.prototype.formatNumber=function(e){return parseInt(e).toFixed(0).replace(/./g,function(e,t,l){return t>0&&"."!==e&&(l.length-t)%3===0?","+e:e})},l.prototype.renderChart=function(){var e=this.chart.view.getContext("2d"),l=this;this.chart.model||(this.chart.model=new Chart(e).Doughnut(this.chart.data,{responsive:!0,animationEasing:"easeInOutQuad",animationSteps:30,legendTemplate:'<ul id="chart-legend-mortgage" class="chart-legend <%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span class="cat-color" style="background-color:<%=segments[i].fillColor%>"></span><span><%if(segments[i].legend){%><%=segments[i].legend%><%}%></span></li><%}%><div class="clearfix"></div></ul>',tooltipTemplate:"<%=label%>"})),this.chart.data.forEach(function(e,t){l.chart.model.segments[t].value=e.value,l.chart.model.segments[t].label=e.label,l.chart.model.segments[t].legend=e.legend}),this.chart.model.update(),t("#chart-legend-mortgage").html(this.chart.model.generateLegend())},l.prototype.renderSchedule=function(){var e=t("#collapse-result .schedule-body"),l='<div class="row schedule-heading"><div class="col-xs-12 col-sm-2">DATE</div><div class="col-xs-12 col-sm-2">PAYMENT</div><div class="col-xs-12 col-sm-2">PRINCIPAL</div><div class="col-xs-12 col-sm-2">INTEREST</div><div class="col-xs-12 col-sm-2">TOTAL INTEREST</div><div class="col-xs-12 col-sm-2">BALANCE</div></div>';e.html(l)},l.prototype.extendObject=function(){for(var e in a)for(var t in this)a[e].prototype.hasOwnProperty(t)||(a[e].prototype[t]=this[t])};var a=function(){};return a.NumberInput=function(e,l){this.model=l;var a="";"#years-field"==e?a=" "+(1==this.model.value?"year":"years"):"#deposit-field"==e&&(a="%");var s=this,i=t('<i class="slider-step fa fa-plus"></i>'),r=t('<i class="slider-step fa fa-minus"></i>'),n=t(this.model.template.replace("{{value}}",'<input type="text" class="number-value" value="'+this.formatNumber(this.model.value)+a+'" />'));this.$value=n.find(".number-value"),this.$slider=this.settings.$node.find(e).val(this.model.value),this.$slider.after(n).after(i).before(r);var o=this.$slider.slider();this.$slider.on("change",function(e){s.model.value=e.value.newValue,s.calculate(),s.update()}),i.click(function(){s.model.value!=s.model.limit.max&&(s.model.value+=s.model.step,s.calculate(),s.update(),o.slider("setValue",s.model.value))}),r.click(function(){s.model.value!=s.model.limit.min&&(s.model.value-=s.model.step,s.calculate(),s.update(),o.slider("setValue",s.model.value))}),this.$value.focusin(function(){t(this).val(t(this).val().replace(/[^\d]+/g,""))}),this.$value.focusout(function(){var e=parseInt(t(this).val());e=e?e:0,e<s.model.limit.min?e=s.model.limit.min:e>s.model.limit.max&&(e=s.model.limit.max),s.model.value=e,s.calculate(),s.update(),o.slider("setValue",s.model.value)})},a.NumberInput.prototype.update=function(){var e="";this.$value.parent().hasClass("years-view")?e=" "+(1==this.model.value?"year":"years"):this.$value.parent().hasClass("deposit-view")&&(e="%"),this.$value.val(this.formatNumber(this.model.value)+e)},l}(window,jQuery);